---
- hosts: all
  become: yes
  tasks:
    - name: Ensure Docker is installed
      apt:
        name: docker.io
        state: present
        update_cache: yes

    - name: Ensure Docker Compose is installed
      get_url:
        url: https://github.com/docker/compose/releases/download/{{ docker_versiyonu }}/docker-compose-$(uname -s)-$(uname -m)
        dest: /usr/local/bin/docker-compose
        mode: '0755'

    - name: Copy cloud directory
      copy:
        src: ../cloud/
        dest: /home/{{ ansible_user }}/cloud/
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
        mode: '0755'
      become: yes
      become_user: "{{ ansible_user }}"

    - name: Copy Docker Compose file
      template:
        src: cloud/docker-compose.yaml.j2
        dest: /home/{{ ansible_user }}/cloud/docker-compose.yaml

    - name: Run Docker Compose
      shell: docker-compose -f /home/{{ ansible_user }}/cloud/docker-compose.yaml up -d
      args:
        chdir: /home/{{ ansible_user }}/cloud/
